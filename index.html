<!DOCTYPE html><html><body>
<h3>ğŸ§ é€£ç·šå¾Œæœƒå³æ™‚æ’­æ”¾éº¥å…‹é¢¨</h3>
<script>
const SAMPLE_RATE = 16000;
const ctx  = new (window.AudioContext||window.webkitAudioContext)({sampleRate: SAMPLE_RATE});
const ws   = new WebSocket("ws://localhost:5678");
ws.binaryType = "arraybuffer";

let queue = [];
function feed() {
  if (queue.length) {
    const int16 = queue.shift();
    const float32 = new Float32Array(int16.length);
    for (let i = 0; i < int16.length; i++) float32[i] = int16[i] / 32768;
    const buf = ctx.createBuffer(1, float32.length, SAMPLE_RATE);
    buf.copyToChannel(float32, 0);
    const src = ctx.createBufferSource();
    src.buffer = buf;
    src.connect(ctx.destination);
    src.start();
  }
  // é€™è£¡ç”¨ setTimeout(0) æ¯” requestAnimationFrame ç©©å®šï¼ˆ60fps < 16k/1024â‰ˆ15fpsï¼‰
  setTimeout(feed, 0);
}

ws.onopen = () => { console.log("å·²é€£ç·š"); feed(); };
ws.onmessage = ev => queue.push(new Int16Array(ev.data));
</script>
</body></html>
